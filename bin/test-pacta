#!/usr/bin/env bash

red () {
    printf "\033[31m${1}\033[0m\n"
}

yellow () {
    printf "\033[33m${1}\033[0m\n"
}

green () {
    printf "\033[32m${1}\033[0m\n"
}

rm -rf ../output ../input
bash bin/setup-io

yellow "IO tree at the start"
tree ../input ../output
echo
docker-compose up --build
echo

yellow "IO tree at the end"
actual=$(tempfile)
tree ../input ../output > "$actual"

cat "$actual"
echo

yellow "Diff with snapshot"
difference=$(diff "$actual" tests/bash/snapshots/results-tree.txt)
if [ $difference -eq "" ];
then
  echo "Good to go"
fi

if [[ $difference -eq "" ]]
then
  green "Good to go."
else
  red "The output tree is NOT as expected:"
fi
echo $difference
echo

yellow "Done"
