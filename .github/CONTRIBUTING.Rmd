---
output: github_document
title: "Contributing to pactaCore"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "",
  echo = FALSE,
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(fs)
library(here)

show <- function(path) writeLines(readLines(here(path)))
```

This document guides contributors. It extends
[README](https://github.com/2DegreesInvesting/pactaCore/blob/main/README.md)
focusing on how this R package differs form a standard one.

## Environment variables

Compared to users, developers must set two additional environment variables in
their .env file:

* `PACTA_ANALYSIS` sets the path where you cloned the PACTA_analysis/
repository. This is used for regression Tests (see [Tests and Git]).

* `PASSWORD` sets the password to login to a local RStudio server running inside
a Docker container on your host computer (see [Docker]).

```{r}
show(".env")
```

## Docker

You can access a dockerized computing environment in four steps:

1. Install `docker`.
2. Install `docker-compose`.
3. Clone pactaCore and make it your working directory.
4. Run `docker-compose up`.

Rstudio is now available from your web browser at localhost:8787. Login with
username "rstudio" and your password (see [Environment variables]).

In the container, the required directories will be mounted under /home/rstudio,
and discovered via the file .env_rstudio:

```{r}
show(".env_rstudio")
```

## Tests and Git

Some tests are slow. You may skip them wiht `test_fast()` and `check_fast()`.

The repository PACTA_analysis/ is required for regression tests. Clone it from
2DII's GitHub organization and keep it up to date with the repo on GitHub.

```bash
git clone git@github.com:2DegreesInvesting/PACTA_analysis.git
```

Git ignores all files under the directory tests/testthat/_snaps/ to avoid
leaking private data. Re-include public snapshots in .gitignore with a negation
pattern (!), e.g.:

```{r}
lines <- readLines(here(".gitignore"))
writeLines(grep("testthat/_snaps", lines, value = TRUE))
```

Git ignores the directory tests/testthat/private/. Use it to store regression
references or other private data.

```{r}
dir_tree(here("tests", "testthat", "private"))
```

You may compare two lists of reference datasets with `compare_full()`.
